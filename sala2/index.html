<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reservas - Sala 2</title>
  <style>
    :root{
      --bg:#0b1220; --card:#101a33; --card2:#0e1730;
      --text:#eaf0ff; --muted:#aab5d6;
      --ok:#36d399; --bad:#ff6b6b; --accent:#7c5cff;
      --border:rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.40);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 700px at 20% -10%, rgba(124,92,255,.35), transparent 55%),
                  radial-gradient(900px 600px at 95% 0%, rgba(54,211,153,.20), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:22px 14px 40px;
    }
    .wrap{width:min(980px, 100%)}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:14px;
    }
    .back{
      text-decoration:none; color:var(--text);
      border:1px solid var(--border);
      padding:10px 12px; border-radius:14px;
      background:rgba(255,255,255,.04);
      display:inline-flex; align-items:center; gap:10px;
    }
    .back:hover{background:rgba(255,255,255,.07)}
    .h{
      display:flex; flex-direction:column; gap:4px;
    }
    .h h1{margin:0; font-size:22px; letter-spacing:.2px}
    .h p{margin:0; color:var(--muted); font-size:13px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap:14px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .head{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(0,0,0,.15);
    }
    .card .head b{font-size:14px}
    .card .body{padding:16px}
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select, button{
      width:100%;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color:var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
    }
    input::placeholder{color:rgba(234,240,255,.45)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:480px){ .row{grid-template-columns:1fr} }
    .btn{
      cursor:pointer;
      border:none;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.65));
      box-shadow: 0 12px 30px rgba(124,92,255,.22);
      font-weight:700;
      padding:12px 14px;
    }
    .btn:hover{filter:brightness(1.07)}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .msg{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-size:13px;
    }
    .msg.ok{color:var(--ok); border-color:rgba(54,211,153,.35)}
    .msg.bad{color:var(--bad); border-color:rgba(255,107,107,.35)}
    .legend{
      display:flex; gap:10px; flex-wrap:wrap;
      color:var(--muted); font-size:12px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:7px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
    }
    .dot{width:10px; height:10px; border-radius:999px}
    .dot.ok{background:var(--ok)}
    .dot.bad{background:var(--bad)}
    .schedule{
      display:grid;
      grid-template-columns: 90px 1fr 80px;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:14px;
      background:rgba(0,0,0,.18);
      margin-bottom:10px;
    }
    .schedule .t{font-weight:700}
    .schedule .who{color:var(--muted); font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .status{
      justify-self:end;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.20);
    }
    .status.ok{color:var(--ok); border-color:rgba(54,211,153,.35)}
    .status.bad{color:var(--bad); border-color:rgba(255,107,107,.35)}
    .small-actions{
      display:flex; gap:10px; margin-top:10px;
    }
    .ghost{
      cursor:pointer;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      font-weight:600;
    }
    .ghost:hover{background:rgba(255,255,255,.09)}
    .danger{
      background:rgba(255,107,107,.14);
      border:1px solid rgba(255,107,107,.35);
      color:#ffd7d7;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <a class="back" href="./index.html" aria-label="Volver">
        ← <span>Volver</span>
      </a>
      <div class="h">
        <h1 id="title">Reservas · Sala 1</h1>
        <p>Selecciona día y horas (máx. 2h). Se guarda en este dispositivo.</p>
      </div>
      <div style="width:94px"></div>
    </div>

    <div class="grid">
      <!-- FORMULARIO -->
      <section class="card">
        <div class="head">
          <b>Crear reserva</b>
          <div class="legend">
            <span class="pill"><span class="dot ok"></span>Libre</span>
            <span class="pill"><span class="dot bad"></span>Ocupado</span>
          </div>
        </div>
        <div class="body">
          <div class="row">
            <div>
              <label for="date">Día</label>
              <input id="date" type="date" />
            </div>
            <div>
              <label for="name">Nombre</label>
              <input id="name" type="text" placeholder="Ej: Eneko / Untsalaz..." maxlength="60" />
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="row">
            <div>
              <label for="start">Hora inicio</label>
              <select id="start"></select>
            </div>
            <div>
              <label for="end">Hora fin (máx. 2h)</label>
              <select id="end"></select>
            </div>
          </div>

          <div style="height:12px"></div>

          <button class="btn" id="bookBtn">Reservar</button>
          <div id="msg" class="msg" style="display:none"></div>

          <div class="small-actions">
            <button class="ghost" id="clearDayBtn" type="button">Borrar reservas de este día</button>
            <button class="ghost danger" id="clearAllBtn" type="button">Borrar TODO</button>
          </div>
        </div>
      </section>

      <!-- DISPONIBILIDAD -->
      <section class="card">
        <div class="head">
          <b>Disponibilidad del día</b>
          <span id="dayLabel" style="color:var(--muted); font-size:12px">—</span>
        </div>
        <div class="body" id="availability"></div>
      </section>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  const SALA_ID = "Sala 2";               // <- CAMBIA ESTO EN sala2.html, sala3.html...
  const STORE_KEY = "reservas_salas_v2";  // (no lo cambies)
  const START_MIN = 9 * 60;              // 09:00
  const END_MIN   = 22 * 60;             // 22:00
  const STEP = 30;                       // 30 min
  const MAX_DURATION = 120;              // 2 horas (120 min)

  // ====== HELPERS ======
  const pad = n => String(n).padStart(2, "0");
  const toTime = mins => `${pad(Math.floor(mins/60))}:${pad(mins%60)}`;
  const parseTime = str => {
    const [h,m] = str.split(":").map(Number);
    return h*60 + m;
  };
  const fmtDateES = (yyyy_mm_dd) => {
    const [y,m,d] = yyyy_mm_dd.split("-").map(Number);
    const dt = new Date(y, m-1, d);
    return dt.toLocaleDateString("es-ES", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
  };
  const overlaps = (aStart, aEnd, bStart, bEnd) => (aStart < bEnd) && (aEnd > bStart);

  const loadAll = () => {
    try { return JSON.parse(localStorage.getItem(STORE_KEY) || "[]"); }
    catch { return []; }
  };
  const saveAll = (arr) => localStorage.setItem(STORE_KEY, JSON.stringify(arr));

  const getReservationsFor = (room, date) => {
    return loadAll()
      .filter(r => r.room === room && r.date === date)
      .sort((x,y) => x.start - y.start);
  };

  // ====== UI REFERENCES ======
  const titleEl = document.getElementById("title");
  const dateEl = document.getElementById("date");
  const nameEl = document.getElementById("name");
  const startEl = document.getElementById("start");
  const endEl = document.getElementById("end");
  const msgEl = document.getElementById("msg");
  const dayLabelEl = document.getElementById("dayLabel");
  const availabilityEl = document.getElementById("availability");
  const bookBtn = document.getElementById("bookBtn");
  const clearDayBtn = document.getElementById("clearDayBtn");
  const clearAllBtn = document.getElementById("clearAllBtn");

  titleEl.textContent = `Reservas · ${SALA_ID}`;
  document.title = `Reservas - ${SALA_ID}`;

  // ====== INIT DATE (HOY) ======
  const today = new Date();
  const y = today.getFullYear();
  const m = pad(today.getMonth()+1);
  const d = pad(today.getDate());
  dateEl.value = `${y}-${m}-${d}`;
  dateEl.min = `${y}-01-01`; // opcional
  dayLabelEl.textContent = fmtDateES(dateEl.value);

  // ====== POPULATE START TIMES ======
  function fillStartTimes(){
    startEl.innerHTML = "";
    for(let t=START_MIN; t<=END_MIN-STEP; t+=STEP){
      // permitimos empezar hasta 21:30 (para terminar 22:00 mínimo)
      const opt = document.createElement("option");
      opt.value = toTime(t);
      opt.textContent = toTime(t);
      startEl.appendChild(opt);
    }
    // por defecto 19:00 si existe, si no la primera
    const prefer = "19:00";
    startEl.value = [...startEl.options].some(o=>o.value===prefer) ? prefer : startEl.options[0].value;
  }

  function fillEndTimes(){
    endEl.innerHTML = "";
    const s = parseTime(startEl.value);
    const maxEnd = Math.min(s + MAX_DURATION, END_MIN);
    for(let t = s + STEP; t <= maxEnd; t += STEP){
      const opt = document.createElement("option");
      opt.value = toTime(t);
      opt.textContent = toTime(t);
      endEl.appendChild(opt);
    }
    // por defecto 1h si se puede
    const oneHour = toTime(Math.min(s + 60, maxEnd));
    endEl.value = [...endEl.options].
